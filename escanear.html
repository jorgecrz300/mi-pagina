<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Esc√°ner de Cantos</title>
    <script src='https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js'></script>
    <style>
        body { font-family: sans-serif; background: #fdfaf6; text-align: center; padding: 20px; color: #5d4037; }
        .caja { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); max-width: 500px; margin: 0 auto; }
        h1 { color: #d35400; }
        #preview { width: 100%; max-height: 300px; object-fit: contain; margin-top: 15px; display: none; border: 2px solid #ddd; }
        .btn-subir { background: #d35400; color: white; padding: 15px; border-radius: 10px; cursor: pointer; display: block; margin: 20px 0; font-weight: bold; }
        #resultado { width: 100%; height: 200px; margin-top: 20px; border-radius: 10px; border: 1px solid #ccc; padding: 10px; box-sizing: border-box; background: #fff; white-space: pre-wrap; text-align: left; overflow-y: auto; }
        .estado { font-weight: bold; color: #27ae60; margin: 10px 0; }
    </style>
</head>
<body>

<div class="caja">
    <h1>üì∏ Esc√°ner de Libreta</h1>
    <p>Sube la foto de la canci√≥n y la IA la escribir√° por ti.</p>

    <label class="btn-subir">
        SELECCIONAR FOTO
        <input type="file" id="archivo" accept="image/*" style="display:none">
    </label>

    <img id="preview" alt="Vista previa">
    
    <div id="status" class="estado"></div>

    <div id="resultado" placeholder="Aqu√≠ aparecer√° el texto..."></div>
    
    <p style="font-size: 12px; margin-top: 15px;">* Nota: Si la foto est√° borrosa, la IA puede fallar un poco.</p>
    <a href="cantosbiblicos.html" style="text-decoration:none; color:#d35400; font-weight:bold;">‚¨Ö VOLVER AL MEN√ö</a>
</div>

<script>
    const archivo = document.getElementById('archivo');
    const preview = document.getElementById('preview');
    const status = document.getElementById('status');
    const resultado = document.getElementById('resultado');

    archivo.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;

        // Mostrar vista previa
        const reader = new FileReader();
        reader.onload = (f) => {
            preview.src = f.target.result;
            preview.style.display = 'block';
            reconocerTexto(f.target.result);
        };
        reader.readAsDataURL(file);
    });

    function reconocerTexto(imagen) {
        status.innerText = "Leyendo letra... (esto tarda unos segundos)";
        resultado.innerText = "";

        Tesseract.recognize(
            imagen,
            'spa', // Idioma espa√±ol
            { logger: m => {
                if(m.status === 'recognizing text') {
                    status.innerText = `Leyendo: ${Math.round(m.progress * 100)}%`;
                }
            }}
        ).then(({ data: { text } }) => {
            status.innerText = "¬°Lectura completa!";
            resultado.innerText = text;
        }).catch(err => {
            status.innerText = "Error al leer la imagen.";
            console.error(err);
        });
    }
</script>

</body>
</html>
