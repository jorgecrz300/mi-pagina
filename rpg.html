<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Cyber-Quest: RPG Edition</title>
    <style>
        :root { --neon: #00ff41; --bg: #0a0a0a; }
        body { background: var(--bg); color: var(--neon); font-family: 'Courier New', monospace; display: flex; flex-direction: column; align-items: center; }
        
        /* Contenedor del Juego */
        #game-container { position: relative; border: 2px solid var(--neon); margin: 20px; box-shadow: 0 0 20px rgba(0,255,65,0.2); }
        canvas { display: block; background: #000; }

        /* Interfaz de Combate (Oculta al inicio) */
        #battle-screen { 
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.9); flex-direction: column; align-items: center; justify-content: center;
        }
        
        .stats-panel { position: fixed; top: 20px; left: 20px; border: 1px solid var(--neon); padding: 10px; background: rgba(0,0,0,0.8); }
        .log { width: 400px; height: 100px; overflow-y: auto; border: 1px solid #444; margin-top: 10px; padding: 5px; font-size: 12px; }
        
        button { background: var(--neon); color: #000; border: none; padding: 10px 20px; margin: 5px; cursor: pointer; font-weight: bold; }
        button:hover { background: #fff; }
    </style>
</head>
<body>

    <div class="stats-panel">
        <div>HACKER: <span id="p-name">Jorge</span></div>
        <div>HP: <span id="p-hp">100</span>/100</div>
        <div>LVL: <span id="p-lvl">1</span></div>
        <div>EXP: <span id="p-exp">0</span></div>
    </div>

    <div id="game-container">
        <canvas id="mapCanvas" width="600" height="400"></canvas>
        
        <div id="battle-screen">
            <h2 id="battle-msg">Â¡VIRUS DETECTADO!</h2>
            <div id="enemy-sprite" style="font-size: 50px; margin: 20px;">ðŸ‘¾</div>
            <div id="enemy-stats" style="margin-bottom: 20px;">Virus HP: 50</div>
            <div>
                <button onclick="atacar()">EJECUTAR EXPLOIT</button>
                <button onclick="curar()">REPARAR SISTEMA</button>
            </div>
        </div>
    </div>

    <div class="log" id="game-log">MÃºevete con las flechas o WASD. Busca los virus.</div>

    <script>
        const canvas = document.getElementById("mapCanvas");
        const ctx = canvas.getContext("2d");
        const log = document.getElementById("game-log");

        // Datos del Jugador
        let player = { x: 50, y: 50, hp: 100, maxHp: 100, lvl: 1, exp: 0, atk: 10 };
        let enemy = { hp: 0, atk: 0, type: "" };
        let inBattle = false;

        // Enemigos en el mapa
        let enemies = [
            {x: 200, y: 150, active: true},
            {x: 450, y: 300, active: true},
            {x: 100, y: 300, active: true}
        ];

        function drawPlayer() {
            ctx.fillStyle = "#00ff41";
            ctx.fillRect(player.x, player.y, 20, 20); // El jugador es un cuadro neon
        }

        function drawMap() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawPlayer();
            
            // Dibujar enemigos
            ctx.fillStyle = "red";
            enemies.forEach(e => {
                if(e.active) ctx.fillText("ðŸ‘¾", e.x, e.y);
            });
        }

        // Movimiento
        window.addEventListener("keydown", (e) => {
            if(inBattle) return;
            if(e.key === "ArrowUp" || e.key === "w") player.y -= 10;
            if(e.key === "ArrowDown" || e.key === "s") player.y += 10;
            if(e.key === "ArrowLeft" || e.key === "a") player.x -= 10;
            if(e.key === "ArrowRight" || e.key === "d") player.x += 10;
            
            checkCollision();
            drawMap();
        });

        function checkCollision() {
            enemies.forEach(e => {
                if(e.active && Math.abs(player.x - e.x) < 20 && Math.abs(player.y - e.y) < 20) {
                    startBattle(e);
                }
            });
        }

        // LÃ³gica de Combate
        function startBattle(enemyObj) {
            inBattle = true;
            enemyObj.active = false;
            enemy.hp = 30 + (player.lvl * 10);
            enemy.atk = 5 + player.lvl;
            document.getElementById("battle-screen").style.display = "flex";
            actualizarInterfaz();
        }

        function atacar() {
            let dmg = player.atk + Math.floor(Math.random() * 5);
            enemy.hp -= dmg;
            log.innerHTML += `<br>Atacaste con ${dmg} de daÃ±o.`;
            
            if(enemy.hp <= 0) {
                winBattle();
            } else {
                enemyTurn();
            }
            actualizarInterfaz();
        }

        function enemyTurn() {
            let eDmg = enemy.atk;
            player.hp -= eDmg;
            log.innerHTML += `<br>El Virus te quitÃ³ ${eDmg} HP.`;
            if(player.hp <= 0) alert("SISTEMA COLAPSADO (GAME OVER)");
        }

        function winBattle() {
            inBattle = false;
            player.exp += 50;
            if(player.exp >= 100) {
                player.lvl++;
                player.exp = 0;
                player.maxHp += 20;
                player.hp = player.maxHp;
                alert("Â¡SUBISTE DE NIVEL!");
            }
            document.getElementById("battle-screen").style.display = "none";
            log.innerHTML += `<br>Ganaste 50 EXP.`;
            drawMap();
        }

        function curar() {
            player.hp = Math.min(player.maxHp, player.hp + 30);
            log.innerHTML += `<br>Reparando sectores... +30 HP.`;
            enemyTurn();
            actualizarInterfaz();
        }

        function actualizarInterfaz() {
            document.getElementById("p-hp").innerText = player.hp;
            document.getElementById("p-lvl").innerText = player.lvl;
            document.getElementById("p-exp").innerText = player.exp;
            document.getElementById("enemy-stats").innerText = `Virus HP: ${enemy.hp}`;
        }

        drawMap();
    </script>
</body>
</html>
