<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Spike Cross Clone</title>
    <style>
        body { background: #1a1a1a; color: white; display: flex; flex-direction: column; align-items: center; font-family: 'Courier New', Courier, monospace; }
        canvas { border: 4px solid #fff; background: #333; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        .ui { margin-top: 10px; }
    </style>
</head>
<body>
    <h2>SPIKE CLONE TEST</h2>
    <canvas id="gameCanvas" width="800" height="400"></canvas>
    <div class="ui">Flechas: Mover | Espacio: Salto y Remate</div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // Configuración
    let player = { x: 150, y: 300, w: 30, h: 60, dy: 0, speed: 7, jumping: false };
    let ball = { x: 400, y: 100, vx: 3, vy: 0, radius: 12, trail: [] };
    const net = { x: 400, y: 250, w: 10, h: 150 };
    const gravity = 0.6;

    function update() {
        // Movimiento Jugador
        player.dy += gravity;
        player.y += player.dy;
        if (player.y > 290) { player.y = 290; player.jumping = false; player.dy = 0; }

        // Física Balón
        ball.vy += gravity * 0.7;
        ball.x += ball.vx;
        ball.y += ball.vy;

        // Guardar posiciones para la estela (Trail)
        ball.trail.push({x: ball.x, y: ball.y});
        if (ball.trail.length > 10) ball.trail.shift();

        // Rebote Suelo y Paredes
        if (ball.y > 338) { ball.vy *= -0.8; ball.y = 338; }
        if (ball.x > 788 || ball.x < 12) ball.vx *= -1;

        // Colisión con la Red
        if (ball.x + ball.radius > net.x && ball.x - ball.radius < net.x + net.w && ball.y > net.y) {
            ball.vx *= -1;
        }

        // REMATE (Spike)
        if (checkCollision(player, ball) && player.jumping) {
            ball.vy = 15; // Golpe hacia abajo
            ball.vx = 12; // Velocidad hacia adelante
            // Efecto visual rápido
            canvas.style.borderColor = "yellow";
            setTimeout(() => canvas.style.borderColor = "white", 100);
        }

        draw();
        requestAnimationFrame(update);
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Dibujar Suelo
        ctx.fillStyle = "#555";
        ctx.fillRect(0, 350, 800, 50);

        // Dibujar Red
        ctx.fillStyle = "white";
        ctx.fillRect(net.x, net.y, net.w, net.h);

        // Dibujar Estela del Balón
        ball.trail.forEach((p, i) => {
            ctx.fillStyle = `rgba(255, 255, 0, ${i / 10})`;
            ctx.beginPath();
            ctx.arc(p.x, p.y, ball.radius * (i / 10), 0, Math.PI * 2);
            ctx.fill();
        });

        // Dibujar Jugador (con color de salto)
        ctx.fillStyle = player.jumping ? "#ff4444" : "#44ccff";
        ctx.fillRect(player.x, player.y, player.w, player.h);

        // Dibujar Balón
        ctx.beginPath();
        ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
        ctx.fillStyle = "yellow";
        ctx.fill();
        ctx.strokeStyle = "black";
        ctx.stroke();
    }

    function checkCollision(p, b) {
        return b.x > p.x - 20 && b.x < p.x + p.w + 20 && b.y > p.y && b.y < p.y + p.h;
    }

    // Controles
    const keys = {};
    window.addEventListener("keydown", e => {
        keys[e.code] = true;
        if (e.code === "Space" && !player.jumping) {
            player.dy = -15;
            player.jumping = true;
        }
    });
    window.addEventListener("keyup", e => keys[e.code] = false);

    // Bucle de movimiento lateral
    setInterval(() => {
        if (keys["ArrowRight"] && player.x < net.x - player.w) player.x += player.speed;
        if (keys["ArrowLeft"] && player.x > 0) player.x -= player.speed;
    }, 20);

    update();
</script>
</body>
</html>
