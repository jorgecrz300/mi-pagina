<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>The Spike Clone - GitHub Edition</title>
    <style>
        body { background: #1a1a1a; color: white; display: flex; flex-direction: column; align-items: center; font-family: Arial, sans-serif; }
        canvas { border: 4px solid #fff; background: #333; margin-top: 20px; }
        .score { font-size: 24px; margin-top: 10px; font-weight: bold; color: #fbff00; }
    </style>
</head>
<body>
    <div class="score">JUGADOR: <span id="p1Score">0</span> | BOT: <span id="p2Score">0</span></div>
    <canvas id="gameCanvas" width="800" height="400"></canvas>
    <p>Flechas para mover | Espacio para saltar y rematar</p>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // Variables de juego
    let scoreP1 = 0;
    let scoreP2 = 0;
    const gravity = 0.6;

    // Entidades
    let player = { x: 100, y: 290, w: 30, h: 60, dy: 0, jumping: false, color: "#44ccff" };
    let bot = { x: 650, y: 290, w: 30, h: 60, dy: 0, jumping: false, color: "#ff4444" };
    let ball = { x: 400, y: 100, vx: 3, vy: 0, radius: 10, trail: [] };
    const net = { x: 395, y: 250, w: 10, h: 150 };

    function update() {
        // --- FÍSICA JUGADOR ---
        player.dy += gravity;
        player.y += player.dy;
        if (player.y > 290) { player.y = 290; player.jumping = false; player.dy = 0; }

        // --- IA DEL BOT ---
        if (ball.x > net.x) { // Solo reacciona si el balón cruza la red
            if (bot.x + 15 < ball.x) bot.x += 4;
            else if (bot.x + 15 > ball.x) bot.x -= 4;
            
            // Saltar si el balón está cerca y a buena altura
            if (Math.abs(bot.x - ball.x) < 30 && ball.y < 250 && !bot.jumping) {
                bot.dy = -13;
                bot.jumping = true;
            }
        }
        bot.dy += gravity;
        bot.y += bot.dy;
        if (bot.y > 290) { bot.y = 290; bot.jumping = false; bot.dy = 0; }

        // --- FÍSICA BALÓN ---
        ball.vy += gravity * 0.7;
        ball.x += ball.vx;
        ball.y += ball.vy;

        // Estela del balón
        ball.trail.push({x: ball.x, y: ball.y});
        if (ball.trail.length > 8) ball.trail.shift();

        // Rebotes y Puntos
        if (ball.y > 340) { // Toca suelo
            if (ball.x < net.x) scoreP2++; // Punto para el bot
            else scoreP1++; // Punto para ti
            resetBall();
        }
        if (ball.x > 790 || ball.x < 10) ball.vx *= -1;

        // Colisión con Red
        if (ball.x + 10 > net.x && ball.x - 10 < net.x + net.w && ball.y > net.y) {
            ball.vx *= -1;
        }

        // --- COLISIONES DE GOLPE ---
        handleHit(player, true);
        handleHit(bot, false);

        document.getElementById("p1Score").innerText = scoreP1;
        document.getElementById("p2Score").innerText = scoreP2;

        draw();
        requestAnimationFrame(update);
    }

    function handleHit(char, isPlayer) {
        if (ball.x > char.x - 20 && ball.x < char.x + char.w + 20 && ball.y > char.y && ball.y < char.y + char.h) {
            if (char.jumping) { // REMATE
                ball.vy = 15;
                ball.vx = isPlayer ? 10 : -10;
            } else { // TOQUE NORMAL
                ball.vy = -12;
                ball.vx = isPlayer ? 4 : -4;
            }
        }
    }

    function resetBall() {
        ball.x = 400; ball.y = 100; ball.vx = (Math.random() > 0.5 ? 3 : -3); ball.vy = 0;
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Red y Suelo
        ctx.fillStyle = "white"; ctx.fillRect(net.x, net.y, net.w, net.h);
        ctx.fillStyle = "#555"; ctx.fillRect(0, 350, 800, 50);

        // Estela
        ball.trail.forEach((p, i) => {
            ctx.fillStyle = `rgba(255, 255, 0, ${i / 8})`;
            ctx.beginPath(); ctx.arc(p.x, p.y, ball.radius * (i/8), 0, Math.PI*2); ctx.fill();
        });

        // Personajes
        ctx.fillStyle = player.color; ctx.fillRect(player.x, player.y, player.w, player.h);
        ctx.fillStyle = bot.color; ctx.fillRect(bot.x, bot.y, bot.w, bot.h);

        // Balón
        ctx.fillStyle = "yellow"; ctx.beginPath(); ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI*2); ctx.fill();
    }

    // Controles
    const keys = {};
    window.addEventListener("keydown", e => {
        keys[e.code] = true;
        if (e.code === "Space" && !player.jumping) { player.dy = -14; player.jumping = true; }
    });
    window.addEventListener("keyup", e => keys[e.code] = false);

    setInterval(() => {
        if (keys["ArrowRight"] && player.x < net.x - 35) player.x += 5;
        if (keys["ArrowLeft"] && player.x > 0) player.x -= 5;
    }, 20);

    update();
</script>
</body>
</html>
